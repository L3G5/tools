<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading List</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 { text-align: center; }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            padding: 8px 16px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #005999; }
        #add-btn { margin-top: 10px; }
        ul {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        li {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            background: #f9f9f9;
            cursor: move;
        }
        li.dragging { opacity: 0.5; }
        .drag-handle { margin-right: 10px; font-size: 18px; }
        .item-content { flex: 1; }
        .link { color: #007acc; text-decoration: none; }
        .link:hover { text-decoration: underline; }
        .link.read { text-decoration: line-through; color: #666; }
        .desc { font-size: 14px; color: #666; margin: 5px 0 0 0; }
        .icons { display: flex; gap: 10px; margin-left: 10px; }
        .status, .quality, .remove { font-size: 18px; cursor: pointer; }
        .remove { opacity: 0.5; }
        .remove:hover { opacity: 1; }
        details { margin-top: 20px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 4px; white-space: pre-wrap; }
        @media (max-width: 600px) {
            li { flex-direction: column; align-items: flex-start; }
            .icons { margin-top: 10px; }
        }
    </style>
</head>
<body>
    <h1>Reading List</h1>
    <p>Add links (first line as URL, rest as description). Drag to reorder, toggle status/quality, remove if needed.</p>
    
    <textarea id="input-text" placeholder="https://example.com&#10;Optional description here..."></textarea>
    <button id="add-btn">Add Link</button>
    
    <ul id="link-list"></ul>
    
    <details>
        <summary>Export Options</summary>
        <button id="export-btn">Export as Markdown</button>
        <pre id="export-output"></pre>
    </details>

    <script>
        let readingList = JSON.parse(localStorage.getItem('readingList')) || [];
        let draggedItem = null;

        function renderList() {
            const ul = document.getElementById('link-list');
            ul.innerHTML = '';
            readingList.forEach((item, index) => {
                const li = document.createElement('li');
                li.draggable = true;
                li.dataset.index = index;

                const dragHandle = document.createElement('span');
                dragHandle.className = 'drag-handle';
                dragHandle.textContent = 'â˜°';

                const content = document.createElement('div');
                content.className = 'item-content';

                const link = document.createElement('a');
                link.className = 'link' + (item.status === 'read' ? ' read' : '');
                link.href = item.url.startsWith('http') ? item.url : '#';
                link.textContent = item.url;
                if (!item.url.startsWith('http')) link.removeAttribute('href');

                const desc = document.createElement('div');
                desc.className = 'desc';
                desc.textContent = item.desc || '';

                content.appendChild(link);
                content.appendChild(desc);

                const icons = document.createElement('div');
                icons.className = 'icons';

                const statusIcon = document.createElement('span');
                statusIcon.className = 'status';
                const statusIcons = {'unread': 'ðŸ”’', 'started': 'ðŸ“–', 'read': 'âœ…'};
                statusIcon.textContent = statusIcons[item.status];
                statusIcon.title = `Status: ${item.status}`;
                statusIcon.addEventListener('click', () => {
                    const statuses = ['unread', 'started', 'read'];
                    const currentIndex = statuses.indexOf(item.status);
                    item.status = statuses[(currentIndex + 1) % statuses.length];
                    saveList();
                    renderList();
                });

                const qualityIcon = document.createElement('span');
                qualityIcon.className = 'quality';
                const qualities = ['meh', 'okay', 'fire', 'double-fire'];
                const emojis = {'meh': 'ðŸ˜', 'okay': 'ðŸ‘', 'fire': 'ðŸ”¥', 'double-fire': 'ðŸ”¥ðŸ”¥'};
                qualityIcon.textContent = emojis[item.quality];
                qualityIcon.title = 'Cycle quality';
                qualityIcon.addEventListener('click', () => {
                    const currentIndex = qualities.indexOf(item.quality);
                    item.quality = qualities[(currentIndex + 1) % qualities.length];
                    saveList();
                    renderList();
                });

                const removeBtn = document.createElement('span');
                removeBtn.className = 'remove';
                removeBtn.textContent = 'ðŸ—‘ï¸';
                removeBtn.title = 'Remove item';
                removeBtn.addEventListener('click', () => {
                    if (confirm('Remove this item?')) {
                        readingList.splice(index, 1);
                        saveList();
                        renderList();
                    }
                });

                icons.appendChild(statusIcon);
                icons.appendChild(qualityIcon);
                icons.appendChild(removeBtn);

                li.appendChild(dragHandle);
                li.appendChild(content);
                li.appendChild(icons);
                ul.appendChild(li);
            });
        }

        function saveList() {
            localStorage.setItem('readingList', JSON.stringify(readingList));
        }

        document.getElementById('add-btn').addEventListener('click', () => {
            const text = document.getElementById('input-text').value.trim();
            if (!text) return;
            const lines = text.split('\n');
            const url = lines[0].trim();
            const desc = lines.slice(1).join('\n').trim();
            readingList.push({ url, desc, status: 'unread', quality: 'meh' });
            saveList();
            renderList();
            document.getElementById('input-text').value = '';
        });

        document.getElementById('link-list').addEventListener('dragstart', (e) => {
            draggedItem = e.target;
            e.target.classList.add('dragging');
        });

        document.getElementById('link-list').addEventListener('dragover', (e) => {
            e.preventDefault();
            const afterElement = getDragAfterElement(e.clientY);
            const ul = document.getElementById('link-list');
            if (afterElement == null) {
                ul.appendChild(draggedItem);
            } else {
                ul.insertBefore(draggedItem, afterElement);
            }
        });

        document.getElementById('link-list').addEventListener('dragend', () => {
            draggedItem.classList.remove('dragging');
            const ul = document.getElementById('link-list');
            const newOrder = [];
            ul.querySelectorAll('li').forEach(li => {
                newOrder.push(readingList[li.dataset.index]);
            });
            readingList = newOrder;
            saveList();
        });

        function getDragAfterElement(y) {
            const draggables = [...document.querySelectorAll('#link-list li:not(.dragging)')];
            return draggables.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        document.getElementById('export-btn').addEventListener('click', () => {
            let md = '';
            readingList.forEach(item => {
                md += `## [${item.url}](${item.url.startsWith('http') ? item.url : item.url})\n`;
                if (item.desc) md += `${item.desc}\n`;
                md += `Status: ${item.status}\nQuality: ${item.quality}\n\n---\n\n`;
            });
            document.getElementById('export-output').textContent = md;
            navigator.clipboard.writeText(md).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard.');
            });
        });

        renderList();
    </script>
</body>
</html>